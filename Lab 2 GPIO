// Universidad del Valle
// Digital 2
// Ana y Dayrin
// Contador de décadas y contador binario con leds

// Librerías
#include <Arduino.h>

// Variables globales
#define Led_1 23
#define Led_2 22
#define Led_3 21
#define Led_4 19
#define Modo 4
#define Mas 5
#define Menos 15
uint8_t b1_state = 1;
uint8_t last_b1_state = 1;
uint8_t b2_state = 0;
uint8_t last_b2_state = 0;
uint8_t count = 1;
uint8_t count2 = 4;

// Prototipos de funciones
int modo(int);
void mostrarBinario(uint8_t numero);

// Función de configuración
void setup() {
  pinMode(Led_1, OUTPUT);
  pinMode(Led_2, OUTPUT);
  pinMode(Led_3, OUTPUT);
  pinMode(Led_4, OUTPUT);
  digitalWrite(Led_1,LOW);
  digitalWrite(Led_2,LOW);
  digitalWrite(Led_3,LOW);
  pinMode(Modo,INPUT_PULLDOWN);
  pinMode(Mas,INPUT_PULLUP);
  pinMode(Menos,INPUT);
}

// Loop principal
void loop() {

  // Lee el botón de modo. O es decena, 1 es binario
  int m = modo(digitalRead(Modo));
  
  // Si está en modo decena
  if (m==0) {
    // Lee el botón más - incrementa la cuenta
    b1_state = digitalRead(Mas);
    // Verificar si el botón ha cambiado de estado
    if (b1_state != last_b1_state) {
        // Verificar si el botón ha sido presionado 
        if (b1_state == 0) {
          // Mostrar el valor actual en las leds
          if (count == 0) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count2 = count+4;
          }
          if (count == 1) {
            digitalWrite(Led_1,HIGH);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count2 = count-1;
          }
          if (count == 2) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,HIGH);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count2 = count-1;
          }
          if (count == 3) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,HIGH);
            digitalWrite(Led_4,LOW);
            count2 = count-1;
          }
          // Incrementar el contador y reiniciar a 0 si está en F = 15
          if (count == 4) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,HIGH);
            count = 0;
            count2 = count-1;
          } else {
            count++;
          }
        }
        // Esperar un momento para evitar el rebote del botón
        delay(200);
        last_b1_state = b1_state;
    } 

    // Botón menos - disminuye
    b2_state = digitalRead(Menos);
    // Verificar si el botón ha cambiado de estado
    if (b2_state != last_b2_state) {
        // Verificar si el botón ha sido presionado 
        if (b2_state == 1) {
          // Mostrar el valor actual en el display
          if (count2 == 1) {
            digitalWrite(Led_1,HIGH);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count = count2+1;
          }
          if (count2 == 2) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,HIGH);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count = count2+1;
          }
          if (count2 == 3) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,HIGH);
            digitalWrite(Led_4,LOW);
            count = count2+1;
          }
        
          if (count2 == 4) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,HIGH);
            count = count2-4;
          }

          // Disminuir el contador y reiniciar a 4
          if (count2 == 0) {
            digitalWrite(Led_1,LOW);
            digitalWrite(Led_2,LOW);
            digitalWrite(Led_3,LOW);
            digitalWrite(Led_4,LOW);
            count2 = 4;
            count = count2+1;
          } else {
            count2--;
          }
        }
        // Esperar un momento para evitar el rebote del botón
        delay(200);
        last_b2_state = b2_state;
    }   
  }
}
} else { // Modo binario
    // Lee el botón más - incrementa la cuenta
    b1_state = digitalRead(Mas);
    if (b1_state != last_b1_state) {
      if (b1_state == 0) {
        count = (count + 1) % 16; // Incrementa y vuelve a 0 después de 15
        mostrarBinario(count);
        delay(200);
      }
      last_b1_state = b1_state;
    }

    // Botón menos - disminuye
    b2_state = digitalRead(Menos);
    if (b2_state != last_b2_state) {
      if (b2_state == 1) {
        count = (count - 1) % 16; // Decrementa y vuelve a 15 después de 0
        mostrarBinario(count);
        delay(200);
      }
      last_b2_state = b2_state;
    }
  }
}

void mostrarBinario(uint8_t numero) {
  digitalWrite(Led_1, numero & 0x01);
  digitalWrite(Led_2, (numero >> 1) & 0x01);
  digitalWrite(Led_3, (numero >> 2) & 0x01);
  digitalWrite(Led_4, (numero >> 3) & 0x01);
}

// Función para determinar el modo
int modo(int x) {
  if (x == 0) {
    return 0;
  } else {
    return 1;
  }
}
